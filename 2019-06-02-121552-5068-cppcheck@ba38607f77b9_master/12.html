
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - mate-sensors-applet</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script language="javascript">
      function getStyle(el,styleProp) {
        if (el.currentStyle)
          var y = el.currentStyle[styleProp];
        else if (window.getComputedStyle)
          var y = document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp);
        return y;
      }
      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;
        if (el.style.display == "block") {
          el.style.display = "none";
          mark.innerHTML = "[+]";
        } else {
          el.style.display = "block";
          mark.innerHTML = "[-]";
        }
      }
      function init_expandables() {
        var elts = document.getElementsByClassName("expandable");
        for (var i = 0; i < elts.length; i++) {
          var el = elts[i];
          var clickable = el.getElementsByTagName("span")[0];
          var marker = clickable.getElementsByClassName("marker")[0];
          var content = el.getElementsByClassName("content")[0];
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.onclick = toggle;
        }
      }
      function set_class_display(c, st) {
        var elements = document.querySelectorAll('.' + c),
            len = elements.length;
        for (i = 0; i < len; i++) {
            elements[i].style.display = st;
        }
      }
      function toggle_class_visibility(id) {
        var box = document.getElementById(id);
        set_class_display(id, box.checked ? '' : 'none');
      }
    </script>
  </head>
  <body onload="init_expandables()">
      <div id="header">
        <h1>Cppcheck report - mate-sensors-applet: sensors-applet/sensors-applet-settings.c </h1>
      </div>
      <div id="menu" dir="rtl">
       <p id="filename"><a href="index.html">Defects:</a> sensors-applet-settings.c</p>
<a href='12.html#line-155'> unreadVariable 155</a><a href='12.html#line-243'> unreadVariable 243</a><a href='12.html#line-546'> unreadVariable 546</a>
      </div>
      <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cm">/*</span>
<a name="line-2"></a><span class="cm"> * Copyright (C) 2005-2009 Alex Murray &lt;murray.alex@gmail.com&gt;</span>
<a name="line-3"></a><span class="cm"> *               2013 Stefano Karapetsas &lt;stefano@karapetsas.com&gt;</span>
<a name="line-4"></a><span class="cm"> *</span>
<a name="line-5"></a><span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<a name="line-6"></a><span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<a name="line-7"></a><span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="line-8"></a><span class="cm"> * (at your option) any later version.</span>
<a name="line-9"></a><span class="cm"> *</span>
<a name="line-10"></a><span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<a name="line-11"></a><span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="line-12"></a><span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="line-13"></a><span class="cm"> * GNU General Public License for more details.</span>
<a name="line-14"></a><span class="cm"> *</span>
<a name="line-15"></a><span class="cm"> * You should have received a copy of the GNU General Public License</span>
<a name="line-16"></a><span class="cm"> * along with this program; if not, write to the Free Software</span>
<a name="line-17"></a><span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="line-18"></a><span class="cm"> */</span>
<a name="line-19"></a>
<a name="line-20"></a><span class="cp">#ifdef HAVE_CONFIG_H</span>
<a name="line-21"></a><span class="cp">#include</span> <span class="cpf">&quot;config.h&quot;</span><span class="cp"></span>
<a name="line-22"></a><span class="cp">#endif </span><span class="cm">/* HAVE_CONFIG_H */</span><span class="cp"></span>
<a name="line-23"></a>
<a name="line-24"></a><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<a name="line-25"></a><span class="cp">#include</span> <span class="cpf">&lt;glib.h&gt;</span><span class="cp"></span>
<a name="line-26"></a><span class="cp">#include</span> <span class="cpf">&quot;sensors-applet.h&quot;</span><span class="cp"></span>
<a name="line-27"></a><span class="cp">#include</span> <span class="cpf">&quot;sensors-applet-settings.h&quot;</span><span class="cp"></span>
<a name="line-28"></a>
<a name="line-29"></a><span class="cm">/* #define SORT_DEBUG */</span>
<a name="line-30"></a><span class="cp">#ifdef SORT_DEBUG</span>
<a name="line-31"></a><span class="cp">#include</span> <span class="cpf">&lt;syslog.h&gt;</span><span class="cp"></span>
<a name="line-32"></a><span class="cp">#endif</span>
<a name="line-33"></a>
<a name="line-34"></a><span class="cm">/* these must be as the gsettings schema in file org.mate.sensors-applet.gschema.xml.in</span>
<a name="line-35"></a><span class="cm"> * gsettings gvariant type string */</span>
<a name="line-36"></a><span class="cp">#define GSGVTS &quot;s&quot;</span>
<a name="line-37"></a><span class="cm">/* gsettings gvariant type string for the array */</span>
<a name="line-38"></a><span class="cp">#define GSGVTSA &quot;as&quot;</span>
<a name="line-39"></a>
<a name="line-40"></a>
<a name="line-41"></a><span class="n">gchar</span><span class="o">*</span> <span class="nf">sensors_applet_settings_get_unique_id</span> <span class="p">(</span><span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">interface</span><span class="p">,</span> <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
<a name="line-42"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">unique_id</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-43"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">unique_id_hash</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-44"></a>    <span class="n">GChecksum</span> <span class="o">*</span><span class="n">checksum</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-45"></a>    <span class="n">guint8</span> <span class="n">digest</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<a name="line-46"></a>    <span class="n">gsize</span> <span class="n">digest_len</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">digest</span><span class="p">);</span>
<a name="line-47"></a>
<a name="line-48"></a>    <span class="n">unique_id</span> <span class="o">=</span> <span class="n">g_strdup_printf</span> <span class="p">(</span><span class="s">&quot;%s/%s/%s&quot;</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
<a name="line-49"></a>
<a name="line-50"></a>    <span class="n">checksum</span> <span class="o">=</span> <span class="n">g_checksum_new</span> <span class="p">(</span><span class="n">G_CHECKSUM_MD5</span><span class="p">);</span>
<a name="line-51"></a>    <span class="n">g_checksum_update</span> <span class="p">(</span><span class="n">checksum</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">guchar</span> <span class="o">*</span><span class="p">)</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">strlen</span> <span class="p">(</span><span class="n">unique_id</span><span class="p">));</span>
<a name="line-52"></a>    <span class="n">g_checksum_get_digest</span> <span class="p">(</span><span class="n">checksum</span><span class="p">,</span> <span class="n">digest</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">digest_len</span><span class="p">);</span>
<a name="line-53"></a>    <span class="n">g_assert</span> <span class="p">(</span><span class="n">digest_len</span> <span class="o">==</span> <span class="mi">16</span><span class="p">);</span>
<a name="line-54"></a>
<a name="line-55"></a>    <span class="n">unique_id_hash</span> <span class="o">=</span> <span class="n">g_strdup</span> <span class="p">(</span><span class="n">g_checksum_get_string</span> <span class="p">(</span><span class="n">checksum</span><span class="p">));</span>
<a name="line-56"></a>
<a name="line-57"></a>    <span class="n">g_checksum_free</span> <span class="p">(</span><span class="n">checksum</span><span class="p">);</span>
<a name="line-58"></a>    <span class="n">g_free</span> <span class="p">(</span><span class="n">unique_id</span><span class="p">);</span>
<a name="line-59"></a>
<a name="line-60"></a>    <span class="k">return</span> <span class="n">unique_id_hash</span><span class="p">;</span>
<a name="line-61"></a><span class="p">}</span>
<a name="line-62"></a>
<a name="line-63"></a><span class="cm">/* load sensors from gsettings with sorting */</span>
<a name="line-64"></a><span class="n">gboolean</span> <span class="nf">sensors_applet_settings_load_sensors</span> <span class="p">(</span><span class="n">SensorsApplet</span> <span class="o">*</span><span class="n">sensors_applet</span><span class="p">)</span> <span class="p">{</span>
<a name="line-65"></a>    <span class="cm">/* everything gets stored except alarm timeout indexes, which</span>
<a name="line-66"></a><span class="cm">    we set to -1, and visible which we set to false for all</span>
<a name="line-67"></a><span class="cm">    parent nodes and true for all child nodes */</span>
<a name="line-68"></a>
<a name="line-69"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">applet_path</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-70"></a>    <span class="cm">/* not sure about pointer, it is unclear if it is freed by loop, probably yes */</span>
<a name="line-71"></a>    <span class="n">GVariantIter</span> <span class="o">*</span><span class="n">iter</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-72"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">gsuid</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-73"></a>
<a name="line-74"></a>    <span class="cm">/* string variables, to help free up memory in loop */</span>
<a name="line-75"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_path</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-76"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_id</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-77"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_label</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-78"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_interface</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-79"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_low_alarm_command</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-80"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_high_alarm_command</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-81"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_graph_color</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-82"></a>
<a name="line-83"></a>    <span class="cm">/* get gsettings path for applet */</span>
<a name="line-84"></a>    <span class="n">applet_path</span> <span class="o">=</span> <span class="n">mate_panel_applet_get_preferences_path</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">applet</span><span class="p">);</span>
<a name="line-85"></a>
<a name="line-86"></a>    <span class="cm">/* get sensors-list array from gsettings */</span>
<a name="line-87"></a>    <span class="n">g_settings_get</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span> <span class="s">&quot;sensors-list&quot;</span><span class="p">,</span> <span class="n">GSGVTSA</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<a name="line-88"></a>
<a name="line-89"></a>    <span class="cm">/* load sensor data into applet one by one</span>
<a name="line-90"></a><span class="cm">     * first get unique id for the sensor</span>
<a name="line-91"></a><span class="cm">     * then load sensor data from gsettings</span>
<a name="line-92"></a><span class="cm">     * then add sensor</span>
<a name="line-93"></a><span class="cm">     * gsuid is freed by g_variant_iter_loop() */</span>
<a name="line-94"></a>    <span class="k">while</span> <span class="p">(</span><span class="n">g_variant_iter_loop</span> <span class="p">(</span><span class="n">iter</span><span class="p">,</span> <span class="n">GSGVTS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gsuid</span><span class="p">))</span> <span class="p">{</span>
<a name="line-95"></a>
<a name="line-96"></a>        <span class="cm">/* load sensor data from gsettings individually</span>
<a name="line-97"></a><span class="cm">         * g_strdup_printf doesn&#39;t free args!</span>
<a name="line-98"></a><span class="cm">         * applet_path is freed at the end */</span>
<a name="line-99"></a>        <span class="n">gchar</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="n">g_strdup_printf</span> <span class="p">(</span><span class="s">&quot;%s%s/&quot;</span><span class="p">,</span> <span class="n">applet_path</span><span class="p">,</span> <span class="n">gsuid</span><span class="p">);</span>
<a name="line-100"></a>        <span class="cm">/*g_free (gsuid);   // freed by loop */</span>
<a name="line-101"></a>
<a name="line-102"></a>        <span class="cm">/* make a schema which points to one sensor data */</span>
<a name="line-103"></a>        <span class="n">GSettings</span> <span class="o">*</span><span class="n">settings</span><span class="p">;</span>
<a name="line-104"></a>        <span class="n">settings</span> <span class="o">=</span> <span class="n">g_settings_new_with_path</span> <span class="p">(</span><span class="s">&quot;org.mate.sensors-applet.sensor&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
<a name="line-105"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a name="line-106"></a>
<a name="line-107"></a>        <span class="cm">/* laod sensor data to temp variables</span>
<a name="line-108"></a><span class="cm">         * g_settings_get_string allocates memory!</span>
<a name="line-109"></a><span class="cm">         * sensors_applet_add_sensor() gtk_tree_store_set() copies strings, so free them */</span>
<a name="line-110"></a>        <span class="n">sensors_applet_add_sensor</span><span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span>
<a name="line-111"></a>            <span class="n">current_path</span> <span class="o">=</span> <span class="n">g_settings_get_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">PATH</span><span class="p">),</span>
<a name="line-112"></a>            <span class="n">current_id</span> <span class="o">=</span> <span class="n">g_settings_get_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ID</span><span class="p">),</span>
<a name="line-113"></a>            <span class="n">current_label</span> <span class="o">=</span> <span class="n">g_settings_get_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">LABEL</span><span class="p">),</span>
<a name="line-114"></a>            <span class="n">current_interface</span> <span class="o">=</span> <span class="n">g_settings_get_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">INTERFACE</span><span class="p">),</span>
<a name="line-115"></a>            <span class="n">g_settings_get_int</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">SENSOR_TYPE</span><span class="p">),</span>
<a name="line-116"></a>            <span class="n">g_settings_get_boolean</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ENABLED</span><span class="p">),</span>
<a name="line-117"></a>            <span class="n">g_settings_get_double</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">LOW_VALUE</span><span class="p">),</span>
<a name="line-118"></a>            <span class="n">g_settings_get_double</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">HIGH_VALUE</span><span class="p">),</span>
<a name="line-119"></a>            <span class="n">g_settings_get_boolean</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ALARM_ENABLED</span><span class="p">),</span>
<a name="line-120"></a>            <span class="n">current_low_alarm_command</span> <span class="o">=</span> <span class="n">g_settings_get_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">LOW_ALARM_COMMAND</span><span class="p">),</span>
<a name="line-121"></a>            <span class="n">current_high_alarm_command</span> <span class="o">=</span> <span class="n">g_settings_get_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">HIGH_ALARM_COMMAND</span><span class="p">),</span>
<a name="line-122"></a>            <span class="n">g_settings_get_int</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ALARM_TIMEOUT</span><span class="p">),</span>
<a name="line-123"></a>            <span class="n">g_settings_get_double</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">MULTIPLIER</span><span class="p">),</span>
<a name="line-124"></a>            <span class="n">g_settings_get_double</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">OFFSET</span><span class="p">),</span>
<a name="line-125"></a>            <span class="n">g_settings_get_int</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ICON_TYPE</span><span class="p">),</span>
<a name="line-126"></a>            <span class="n">current_graph_color</span> <span class="o">=</span> <span class="n">g_settings_get_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">GRAPH_COLOR</span><span class="p">));</span>
<a name="line-127"></a>
<a name="line-128"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">current_path</span><span class="p">);</span>
<a name="line-129"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">current_id</span><span class="p">);</span>
<a name="line-130"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">current_label</span><span class="p">);</span>
<a name="line-131"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">current_interface</span><span class="p">);</span>
<a name="line-132"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">current_low_alarm_command</span><span class="p">);</span>
<a name="line-133"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">current_high_alarm_command</span><span class="p">);</span>
<a name="line-134"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">current_graph_color</span><span class="p">);</span>
<a name="line-135"></a>
<a name="line-136"></a>        <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">settings</span><span class="p">);</span>
<a name="line-137"></a>
<a name="line-138"></a>    <span class="p">}</span>
<a name="line-139"></a>
<a name="line-140"></a>    <span class="n">g_free</span> <span class="p">(</span><span class="n">applet_path</span><span class="p">);</span>
<a name="line-141"></a>
<a name="line-142"></a>    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-143"></a><span class="p">}</span>
<a name="line-144"></a>
<a name="line-145"></a><span class="cp">#ifdef SORT_DEBUG</span>
<a name="line-146"></a><span class="cm">/* print a gtk_tree_store (for debug) */</span>
<a name="line-147"></a><span class="k">static</span> <span class="kt">void</span> <span class="nf">sensors_applet_settings_print_sensors_tree</span> <span class="p">(</span><span class="n">SensorsApplet</span> <span class="o">*</span><span class="n">sensors_applet</span><span class="p">)</span> <span class="p">{</span>
<a name="line-148"></a>
<a name="line-149"></a>    <span class="n">g_assert</span><span class="p">(</span><span class="n">sensors_applet</span><span class="p">);</span>
<a name="line-150"></a>    <span class="n">g_assert</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">);</span>
<a name="line-151"></a>
<a name="line-152"></a>    <span class="n">GtkTreeIter</span> <span class="n">interfaces_iter</span><span class="p">;</span>
<a name="line-153"></a>    <span class="n">GtkTreeIter</span> <span class="n">sensors_iter</span><span class="p">;</span>
<a name="line-154"></a>    <span class="n">gboolean</span> <span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-155"></a><span class="hll">    <span class="n">gboolean</span> <span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span><span class='error2'>&lt;--- Variable 'not_end_of_sensors' is assigned a value that is never used.</span>
</span><a name="line-156"></a>    <span class="n">gint</span> <span class="n">interfaces_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-157"></a>    <span class="n">gint</span> <span class="n">sensors_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-158"></a>
<a name="line-159"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">interface_name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-160"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">sensor_id</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-161"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">sensor_path</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-162"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">sensor_hash</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-163"></a>
<a name="line-164"></a>    <span class="cm">/* iterate through the sensor tree</span>
<a name="line-165"></a><span class="cm">     * code from sensors-applet.c sensors_applet_add_sensor()</span>
<a name="line-166"></a><span class="cm">     * first go through the interfaces */</span>
<a name="line-167"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">gtk_tree_model_get_iter_first</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">);</span>
<a name="line-168"></a>        <span class="n">not_end_of_interfaces</span><span class="p">;</span>
<a name="line-169"></a>        <span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">),</span> <span class="n">interfaces_counter</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a name="line-170"></a>
<a name="line-171"></a>        <span class="cm">/* get interface name */</span>
<a name="line-172"></a>        <span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">,</span> <span class="n">INTERFACE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">interface_name</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<a name="line-173"></a>
<a name="line-174"></a>        <span class="cm">/* print interface name */</span>
<a name="line-175"></a>        <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERR</span><span class="p">,</span> <span class="s">&quot;#%d interface name: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">interfaces_counter</span><span class="p">,</span> <span class="n">interface_name</span><span class="p">);</span>
<a name="line-176"></a>
<a name="line-177"></a>        <span class="cm">/* then go through the individual sensors under one interface */</span>
<a name="line-178"></a>        <span class="k">for</span> <span class="p">(</span><span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_children</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">);</span>
<a name="line-179"></a>            <span class="n">not_end_of_sensors</span><span class="p">;</span>
<a name="line-180"></a>            <span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">),</span> <span class="n">sensors_counter</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a name="line-181"></a>
<a name="line-182"></a>            <span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">,</span>
<a name="line-183"></a>                       <span class="n">PATH_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sensor_path</span><span class="p">,</span>
<a name="line-184"></a>                       <span class="n">ID_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sensor_id</span><span class="p">,</span>
<a name="line-185"></a>                       <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<a name="line-186"></a>
<a name="line-187"></a>            <span class="n">sensor_hash</span> <span class="o">=</span> <span class="n">sensors_applet_settings_get_unique_id</span> <span class="p">(</span><span class="n">interface_name</span><span class="p">,</span> <span class="n">sensor_id</span><span class="p">,</span> <span class="n">sensor_path</span><span class="p">);</span>
<a name="line-188"></a>
<a name="line-189"></a>            <span class="cm">/* print sensor data */</span>
<a name="line-190"></a>            <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERR</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">#%d sensor id: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sensors_counter</span><span class="p">,</span> <span class="n">sensor_id</span><span class="p">);</span>
<a name="line-191"></a>            <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERR</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">#%d sensor path: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sensors_counter</span><span class="p">,</span> <span class="n">sensor_path</span><span class="p">);</span>
<a name="line-192"></a>            <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERR</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">#%d sensor hash: %s</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sensors_counter</span><span class="p">,</span> <span class="n">sensor_hash</span><span class="p">);</span>
<a name="line-193"></a>
<a name="line-194"></a>            <span class="n">g_free</span><span class="p">(</span><span class="n">sensor_id</span><span class="p">);</span>
<a name="line-195"></a>            <span class="n">g_free</span><span class="p">(</span><span class="n">sensor_path</span><span class="p">);</span>
<a name="line-196"></a>            <span class="n">g_free</span><span class="p">(</span><span class="n">sensor_hash</span><span class="p">);</span>
<a name="line-197"></a>
<a name="line-198"></a>        <span class="p">}</span>
<a name="line-199"></a>
<a name="line-200"></a>        <span class="n">g_free</span><span class="p">(</span><span class="n">interface_name</span><span class="p">);</span>
<a name="line-201"></a>
<a name="line-202"></a>    <span class="p">}</span>
<a name="line-203"></a>
<a name="line-204"></a><span class="p">}</span>
<a name="line-205"></a><span class="cp">#endif</span>
<a name="line-206"></a>
<a name="line-207"></a><span class="cm">/* compare two iters using their paths</span>
<a name="line-208"></a><span class="cm"> * kinda same as active_sensor_compare () */</span>
<a name="line-209"></a><span class="k">static</span> <span class="n">gint</span> <span class="nf">sensors_applet_settings_sort_sensors_iter_compare</span> <span class="p">(</span><span class="n">SensorsApplet</span> <span class="o">*</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">GtkTreeIter</span> <span class="n">ti_a</span><span class="p">,</span> <span class="n">GtkTreeIter</span> <span class="n">ti_b</span><span class="p">)</span> <span class="p">{</span>
<a name="line-210"></a>
<a name="line-211"></a>    <span class="n">GtkTreePath</span> <span class="o">*</span><span class="n">tp_a</span><span class="p">;</span>
<a name="line-212"></a>    <span class="n">GtkTreePath</span> <span class="o">*</span><span class="n">tp_b</span><span class="p">;</span>
<a name="line-213"></a>    <span class="n">gint</span> <span class="n">ret_val</span><span class="p">;</span>
<a name="line-214"></a>
<a name="line-215"></a>    <span class="n">tp_a</span> <span class="o">=</span> <span class="n">gtk_tree_model_get_path</span> <span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">ti_a</span><span class="p">);</span>
<a name="line-216"></a>    <span class="n">tp_b</span> <span class="o">=</span> <span class="n">gtk_tree_model_get_path</span> <span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">ti_b</span><span class="p">);</span>
<a name="line-217"></a>
<a name="line-218"></a>    <span class="n">ret_val</span> <span class="o">=</span> <span class="n">gtk_tree_path_compare</span><span class="p">(</span><span class="n">tp_a</span><span class="p">,</span> <span class="n">tp_b</span><span class="p">);</span>
<a name="line-219"></a>
<a name="line-220"></a>    <span class="n">gtk_tree_path_free</span><span class="p">(</span><span class="n">tp_a</span><span class="p">);</span>
<a name="line-221"></a>    <span class="n">gtk_tree_path_free</span><span class="p">(</span><span class="n">tp_b</span><span class="p">);</span>
<a name="line-222"></a>
<a name="line-223"></a>    <span class="k">return</span> <span class="n">ret_val</span><span class="p">;</span>
<a name="line-224"></a><span class="p">}</span>
<a name="line-225"></a>
<a name="line-226"></a><span class="cm">/* find two sensors in the sensors tree based on their hash and sort them</span>
<a name="line-227"></a><span class="cm"> * Return codes:</span>
<a name="line-228"></a><span class="cm"> * 0: something went very wrong...</span>
<a name="line-229"></a><span class="cm"> * 1: normal run, a and b are in place</span>
<a name="line-230"></a><span class="cm"> * 2: hash_b has already been removed from the system</span>
<a name="line-231"></a><span class="cm"> * 3: hash_a is not found */</span>
<a name="line-232"></a><span class="k">static</span> <span class="n">gint</span> <span class="nf">sensors_applet_settings_sort_sensors_sort</span> <span class="p">(</span><span class="n">SensorsApplet</span> <span class="o">*</span><span class="n">sensors_applet</span><span class="p">,</span>
<a name="line-233"></a>                                                           <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">hash_a</span><span class="p">,</span>
<a name="line-234"></a>                                                           <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">hash_b</span><span class="p">,</span>
<a name="line-235"></a>                                                           <span class="n">gboolean</span> <span class="n">a_is_first</span><span class="p">)</span> <span class="p">{</span>
<a name="line-236"></a>
<a name="line-237"></a>    <span class="n">g_assert</span><span class="p">(</span><span class="n">sensors_applet</span><span class="p">);</span>
<a name="line-238"></a>    <span class="n">g_assert</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">);</span>
<a name="line-239"></a>
<a name="line-240"></a>    <span class="n">GtkTreeIter</span> <span class="n">interfaces_iter</span><span class="p">;</span>
<a name="line-241"></a>    <span class="n">GtkTreeIter</span> <span class="n">sensors_iter</span><span class="p">;</span>
<a name="line-242"></a>    <span class="n">gboolean</span> <span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-243"></a><span class="hll">    <span class="n">gboolean</span> <span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span><span class='error2'>&lt;--- Variable 'not_end_of_sensors' is assigned a value that is never used.</span>
</span><a name="line-244"></a>
<a name="line-245"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">interface_name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-246"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">sensor_id</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-247"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">sensor_path</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-248"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">sensor_hash</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-249"></a>
<a name="line-250"></a>    <span class="n">GtkTreeIter</span> <span class="n">interface_iter_a</span><span class="p">;</span>
<a name="line-251"></a>    <span class="n">GtkTreeIter</span> <span class="n">interface_iter_b</span><span class="p">;</span>
<a name="line-252"></a>    <span class="n">GtkTreeIter</span> <span class="n">sensor_iter_a</span><span class="p">;</span>
<a name="line-253"></a>    <span class="n">GtkTreeIter</span> <span class="n">sensor_iter_b</span><span class="p">;</span>
<a name="line-254"></a>    <span class="n">gboolean</span> <span class="n">found_a</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<a name="line-255"></a>    <span class="n">gboolean</span> <span class="n">found_b</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<a name="line-256"></a>
<a name="line-257"></a>    <span class="cm">/* iterate through the sensor tree</span>
<a name="line-258"></a><span class="cm">     * code from sensors-applet.c sensors_applet_add_sensor()</span>
<a name="line-259"></a><span class="cm">     * first go through the interfaces */</span>
<a name="line-260"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">gtk_tree_model_get_iter_first</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">);</span>
<a name="line-261"></a>        <span class="n">not_end_of_interfaces</span><span class="p">;</span>
<a name="line-262"></a>        <span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">))</span> <span class="p">{</span>
<a name="line-263"></a>
<a name="line-264"></a>        <span class="cm">/* get interface name */</span>
<a name="line-265"></a>        <span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">,</span> <span class="n">INTERFACE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">interface_name</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<a name="line-266"></a>
<a name="line-267"></a>        <span class="cm">/* then go through the individual sensors under one interface */</span>
<a name="line-268"></a>        <span class="k">for</span> <span class="p">(</span><span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_children</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">);</span>
<a name="line-269"></a>            <span class="n">not_end_of_sensors</span><span class="p">;</span>
<a name="line-270"></a>            <span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">))</span> <span class="p">{</span>
<a name="line-271"></a>
<a name="line-272"></a>            <span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">,</span>
<a name="line-273"></a>                       <span class="n">PATH_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sensor_path</span><span class="p">,</span>
<a name="line-274"></a>                       <span class="n">ID_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sensor_id</span><span class="p">,</span>
<a name="line-275"></a>                       <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<a name="line-276"></a>
<a name="line-277"></a>            <span class="n">sensor_hash</span> <span class="o">=</span> <span class="n">sensors_applet_settings_get_unique_id</span> <span class="p">(</span><span class="n">interface_name</span><span class="p">,</span> <span class="n">sensor_id</span><span class="p">,</span> <span class="n">sensor_path</span><span class="p">);</span>
<a name="line-278"></a>
<a name="line-279"></a>            <span class="cm">/* save interface_name and iters for swap */</span>
<a name="line-280"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">g_ascii_strcasecmp</span><span class="p">(</span><span class="n">sensor_hash</span><span class="p">,</span> <span class="n">hash_a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-281"></a>                <span class="cm">/* can copy by value, don&#39;t free */</span>
<a name="line-282"></a>                <span class="n">interface_iter_a</span> <span class="o">=</span> <span class="n">interfaces_iter</span><span class="p">;</span>
<a name="line-283"></a>                <span class="n">sensor_iter_a</span> <span class="o">=</span> <span class="n">sensors_iter</span><span class="p">;</span>
<a name="line-284"></a>                <span class="n">found_a</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-285"></a>            <span class="p">}</span>
<a name="line-286"></a>
<a name="line-287"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">g_ascii_strcasecmp</span><span class="p">(</span><span class="n">sensor_hash</span><span class="p">,</span> <span class="n">hash_b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-288"></a>                <span class="n">interface_iter_b</span> <span class="o">=</span> <span class="n">interfaces_iter</span><span class="p">;</span>
<a name="line-289"></a>                <span class="n">sensor_iter_b</span> <span class="o">=</span> <span class="n">sensors_iter</span><span class="p">;</span>
<a name="line-290"></a>                <span class="n">found_b</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-291"></a>            <span class="p">}</span>
<a name="line-292"></a>
<a name="line-293"></a>            <span class="n">g_free</span><span class="p">(</span><span class="n">sensor_id</span><span class="p">);</span>
<a name="line-294"></a>            <span class="n">g_free</span><span class="p">(</span><span class="n">sensor_path</span><span class="p">);</span>
<a name="line-295"></a>            <span class="n">g_free</span><span class="p">(</span><span class="n">sensor_hash</span><span class="p">);</span>
<a name="line-296"></a>
<a name="line-297"></a>            <span class="cm">/* break after freeing loop variables */</span>
<a name="line-298"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">found_a</span> <span class="o">&amp;&amp;</span> <span class="n">found_b</span><span class="p">)</span> <span class="p">{</span>
<a name="line-299"></a>                <span class="k">break</span><span class="p">;</span>
<a name="line-300"></a>            <span class="p">}</span>
<a name="line-301"></a>        <span class="p">}</span>
<a name="line-302"></a>
<a name="line-303"></a>        <span class="n">g_free</span><span class="p">(</span><span class="n">interface_name</span><span class="p">);</span>
<a name="line-304"></a>
<a name="line-305"></a>        <span class="cm">/* break after freeing loop variables */</span>
<a name="line-306"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">found_a</span> <span class="o">&amp;&amp;</span> <span class="n">found_b</span><span class="p">)</span> <span class="p">{</span>
<a name="line-307"></a>            <span class="k">break</span><span class="p">;</span>
<a name="line-308"></a>        <span class="p">}</span>
<a name="line-309"></a>    <span class="p">}</span>
<a name="line-310"></a>
<a name="line-311"></a>    <span class="cm">/* make the switch */</span>
<a name="line-312"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">found_a</span> <span class="o">&amp;&amp;</span> <span class="n">found_b</span><span class="p">)</span> <span class="p">{</span>
<a name="line-313"></a>
<a name="line-314"></a>        <span class="n">GtkTreeIter</span> <span class="n">first_iter</span><span class="p">;</span>
<a name="line-315"></a>        <span class="n">GtkTreeIter</span> <span class="n">iter_next</span><span class="p">;</span>
<a name="line-316"></a>
<a name="line-317"></a>        <span class="n">gint</span> <span class="n">ret_val</span><span class="p">;</span>
<a name="line-318"></a>
<a name="line-319"></a>        <span class="cm">/* set a&#39;s interface to be the first interface in the sensors tree */</span>
<a name="line-320"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">a_is_first</span><span class="p">)</span> <span class="p">{</span>
<a name="line-321"></a>
<a name="line-322"></a>            <span class="cm">/* this &#39;fails&#39; if the tree is empty, but this is already checked with the first loop */</span>
<a name="line-323"></a>            <span class="n">gtk_tree_model_get_iter_first</span> <span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">first_iter</span><span class="p">);</span>
<a name="line-324"></a>
<a name="line-325"></a>            <span class="cm">/* we are only interested in the case, where the two are not equal</span>
<a name="line-326"></a><span class="cm">             * that means the a&#39;s interface is not the first interface */</span>
<a name="line-327"></a>            <span class="k">if</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">sensors_applet_settings_sort_sensors_iter_compare</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">first_iter</span><span class="p">,</span> <span class="n">interface_iter_a</span><span class="p">))</span> <span class="p">{</span>
<a name="line-328"></a>
<a name="line-329"></a>                <span class="cm">/* it should be, so it needs to be moved to the first position */</span>
<a name="line-330"></a>                <span class="n">gtk_tree_store_move_after</span> <span class="p">(</span><span class="n">GTK_TREE_STORE</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interface_iter_a</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-331"></a>            <span class="p">}</span>
<a name="line-332"></a>
<a name="line-333"></a>        <span class="p">}</span>
<a name="line-334"></a>
<a name="line-335"></a>        <span class="cm">/* check b&#39;s interface position</span>
<a name="line-336"></a><span class="cm">         * (1) if it is before a&#39;s if. - not possible, bc I have just set a&#39;s if. as first</span>
<a name="line-337"></a><span class="cm">         * afterwards every new if. will be set right after (one) a&#39;s if.</span>
<a name="line-338"></a><span class="cm">         * (0) if it is the same as a&#39;s, noop</span>
<a name="line-339"></a><span class="cm">         * (-1) if it is after a, check if it is right after a, if not move it there */</span>
<a name="line-340"></a>        <span class="n">ret_val</span> <span class="o">=</span> <span class="n">sensors_applet_settings_sort_sensors_iter_compare</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">interface_iter_a</span><span class="p">,</span> <span class="n">interface_iter_b</span><span class="p">);</span>
<a name="line-341"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">ret_val</span><span class="p">)</span> <span class="p">{</span>
<a name="line-342"></a>
<a name="line-343"></a>            <span class="cm">/* set iter_next to the iter after a&#39;s if. iter, can copy like this */</span>
<a name="line-344"></a>            <span class="n">iter_next</span> <span class="o">=</span> <span class="n">interface_iter_a</span><span class="p">;</span>
<a name="line-345"></a>            <span class="cm">/* this &#39;fails&#39; if there is no node after a&#39;s if. iter, but we already know, that at least b&#39;s if. iter is */</span>
<a name="line-346"></a>            <span class="n">gtk_tree_model_iter_next</span> <span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">iter_next</span><span class="p">);</span>
<a name="line-347"></a>
<a name="line-348"></a>            <span class="cm">/* the node right after a&#39;s if. iter is not b&#39;s if. iter, so move b&#39;s if. iter */</span>
<a name="line-349"></a>            <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">sensors_applet_settings_sort_sensors_iter_compare</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">iter_next</span><span class="p">,</span> <span class="n">interface_iter_b</span><span class="p">))</span> <span class="p">{</span>
<a name="line-350"></a>
<a name="line-351"></a>                <span class="n">gtk_tree_store_move_after</span> <span class="p">(</span><span class="n">GTK_TREE_STORE</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interface_iter_b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">interface_iter_a</span><span class="p">);</span>
<a name="line-352"></a>            <span class="p">}</span>
<a name="line-353"></a>        <span class="p">}</span>
<a name="line-354"></a>
<a name="line-355"></a>
<a name="line-356"></a>        <span class="cm">/* at this point the interfaces are sorted, the sensors are next */</span>
<a name="line-357"></a>        <span class="cm">/* set a to be the first sensor in the sensors tree, under the first if. iter */</span>
<a name="line-358"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">a_is_first</span><span class="p">)</span> <span class="p">{</span>
<a name="line-359"></a>
<a name="line-360"></a>            <span class="cm">/* this &#39;fails&#39; if the tree is empty, but at least a is in it */</span>
<a name="line-361"></a>            <span class="n">gtk_tree_model_iter_children</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">first_iter</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">interface_iter_a</span><span class="p">);</span>
<a name="line-362"></a>
<a name="line-363"></a>            <span class="cm">/* we are only interested in the case, where the two are not equal</span>
<a name="line-364"></a><span class="cm">             * that means the a is not the first sensor */</span>
<a name="line-365"></a>            <span class="k">if</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">sensors_applet_settings_sort_sensors_iter_compare</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">first_iter</span><span class="p">,</span> <span class="n">sensor_iter_a</span><span class="p">))</span> <span class="p">{</span>
<a name="line-366"></a>
<a name="line-367"></a>                <span class="cm">/* it should be, so it needs to be moved to the first position */</span>
<a name="line-368"></a>                <span class="n">gtk_tree_store_move_after</span> <span class="p">(</span><span class="n">GTK_TREE_STORE</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensor_iter_a</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-369"></a>            <span class="p">}</span>
<a name="line-370"></a>
<a name="line-371"></a>        <span class="p">}</span>
<a name="line-372"></a>
<a name="line-373"></a>        <span class="cm">/* check b&#39;s position</span>
<a name="line-374"></a><span class="cm">         * if a&#39;s if. and b&#39;s if is the same</span>
<a name="line-375"></a><span class="cm">         * (1) if it is before a&#39;s if. - not possible, bc I have just set a as first</span>
<a name="line-376"></a><span class="cm">         * afterwards every new sensor will be set right after (one) a</span>
<a name="line-377"></a><span class="cm">         * (0) if it is the same as a&#39;s, not possible, a and b would be equal</span>
<a name="line-378"></a><span class="cm">         * (-1) if it is after a, check if it is right after a, if not move it there */</span>
<a name="line-379"></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">ret_val</span> <span class="o">&amp;&amp;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">sensors_applet_settings_sort_sensors_iter_compare</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">sensor_iter_a</span><span class="p">,</span> <span class="n">sensor_iter_b</span><span class="p">))</span> <span class="p">{</span>
<a name="line-380"></a>
<a name="line-381"></a>            <span class="cm">/* set iter_next to the iter after a&#39;s iter, can copy like this */</span>
<a name="line-382"></a>            <span class="n">iter_next</span> <span class="o">=</span> <span class="n">sensor_iter_a</span><span class="p">;</span>
<a name="line-383"></a>            <span class="cm">/* this &#39;fails&#39; if there is no node after a&#39;s iter, but we already know, that at least b&#39;s iter is */</span>
<a name="line-384"></a>            <span class="n">gtk_tree_model_iter_next</span> <span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">iter_next</span><span class="p">);</span>
<a name="line-385"></a>
<a name="line-386"></a>            <span class="cm">/* the node right after a&#39;s iter is not b&#39;s iter, so move b&#39;s iter */</span>
<a name="line-387"></a>            <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">sensors_applet_settings_sort_sensors_iter_compare</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">iter_next</span><span class="p">,</span> <span class="n">sensor_iter_b</span><span class="p">))</span> <span class="p">{</span>
<a name="line-388"></a>
<a name="line-389"></a>                <span class="n">gtk_tree_store_move_after</span> <span class="p">(</span><span class="n">GTK_TREE_STORE</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensor_iter_b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sensor_iter_a</span><span class="p">);</span>
<a name="line-390"></a>            <span class="p">}</span>
<a name="line-391"></a>        <span class="p">}</span>
<a name="line-392"></a>
<a name="line-393"></a>        <span class="cm">/* if a&#39;s if. and b&#39;s if is not the same</span>
<a name="line-394"></a><span class="cm">         * as b comes after a, b must be under a new if.</span>
<a name="line-395"></a><span class="cm">         * and so b must be the first node under that if. */</span>
<a name="line-396"></a>        <span class="cm">/* set b to be the first sensor in the sensors tree, under the b&#39;s if. iter */</span>
<a name="line-397"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">ret_val</span><span class="p">)</span> <span class="p">{</span>
<a name="line-398"></a>
<a name="line-399"></a>            <span class="cm">/* this &#39;fails&#39; if the tree is empty, but at least b is in it */</span>
<a name="line-400"></a>            <span class="n">gtk_tree_model_iter_children</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">first_iter</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">interface_iter_b</span><span class="p">);</span>
<a name="line-401"></a>
<a name="line-402"></a>            <span class="cm">/* we are only interested in the case, where the two are not equal</span>
<a name="line-403"></a><span class="cm">             * that means the b is not the first sensor */</span>
<a name="line-404"></a>            <span class="k">if</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">sensors_applet_settings_sort_sensors_iter_compare</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">first_iter</span><span class="p">,</span> <span class="n">sensor_iter_b</span><span class="p">))</span> <span class="p">{</span>
<a name="line-405"></a>
<a name="line-406"></a>                <span class="cm">/* it should be, so it needs to be moved to the first position */</span>
<a name="line-407"></a>                <span class="n">gtk_tree_store_move_after</span> <span class="p">(</span><span class="n">GTK_TREE_STORE</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensor_iter_b</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-408"></a>            <span class="p">}</span>
<a name="line-409"></a>
<a name="line-410"></a>        <span class="p">}</span>
<a name="line-411"></a>
<a name="line-412"></a>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-413"></a>
<a name="line-414"></a>    <span class="p">}</span>
<a name="line-415"></a>
<a name="line-416"></a>    <span class="cm">/* hash_b has already been removed from the system */</span>
<a name="line-417"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">found_a</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">found_b</span><span class="p">)</span> <span class="p">{</span>
<a name="line-418"></a>        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<a name="line-419"></a>    <span class="p">}</span>
<a name="line-420"></a>
<a name="line-421"></a>    <span class="cm">/* this is the least likely case</span>
<a name="line-422"></a><span class="cm">     * if hash_a is not found, then the sensors-list starts with a sensor</span>
<a name="line-423"></a><span class="cm">     * that has already been removed from the system */</span>
<a name="line-424"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">found_a</span><span class="p">)</span> <span class="p">{</span>
<a name="line-425"></a>        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
<a name="line-426"></a>    <span class="p">}</span>
<a name="line-427"></a>
<a name="line-428"></a>    <span class="cm">/* we should never get here */</span>
<a name="line-429"></a>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-430"></a><span class="p">}</span>
<a name="line-431"></a>
<a name="line-432"></a><span class="cm">/* sort sensors based on sensors-list array in gsettings */</span>
<a name="line-433"></a><span class="n">gboolean</span> <span class="nf">sensors_applet_settings_sort_sensors</span> <span class="p">(</span><span class="n">SensorsApplet</span> <span class="o">*</span><span class="n">sensors_applet</span><span class="p">)</span> <span class="p">{</span>
<a name="line-434"></a>
<a name="line-435"></a>    <span class="n">gchar</span> <span class="o">**</span><span class="n">sensors_list</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-436"></a>
<a name="line-437"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">hash_a</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-438"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">hash_b</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-439"></a>
<a name="line-440"></a>    <span class="n">gint</span> <span class="n">ret_val</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="line-441"></a>    <span class="cm">/* marks the first iteration */</span>
<a name="line-442"></a>    <span class="n">gint</span> <span class="n">first_counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-443"></a>
<a name="line-444"></a>    <span class="cm">/* get sensors-list array from gsettings</span>
<a name="line-445"></a><span class="cm">     * newly allocated, has to be freed fully</span>
<a name="line-446"></a><span class="cm">     * for an empty array a pointer to a NULL pointer will be returned (g_variant_dup_strv ()) */</span>
<a name="line-447"></a>    <span class="n">sensors_list</span> <span class="o">=</span> <span class="n">g_settings_get_strv</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span> <span class="s">&quot;sensors-list&quot;</span><span class="p">);</span>
<a name="line-448"></a>
<a name="line-449"></a>    <span class="cm">/* list is empty (on the first run) */</span>
<a name="line-450"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="o">*</span><span class="n">sensors_list</span><span class="p">)</span> <span class="p">{</span>
<a name="line-451"></a>        <span class="cm">/* still need to free the array, even if it is empty */</span>
<a name="line-452"></a>        <span class="n">g_strfreev</span> <span class="p">(</span><span class="n">sensors_list</span><span class="p">);</span>
<a name="line-453"></a>        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<a name="line-454"></a>    <span class="p">}</span>
<a name="line-455"></a>
<a name="line-456"></a>    <span class="n">gint</span> <span class="n">i</span><span class="p">;</span>
<a name="line-457"></a>    <span class="cm">/* hash lists are equal */</span>
<a name="line-458"></a>    <span class="n">gboolean</span> <span class="n">hle</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-459"></a>    <span class="cm">/* compare saved sorted list to newly loaded sensors&#39; list */</span>
<a name="line-460"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors_hash_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">sensors_list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a name="line-461"></a>
<a name="line-462"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">g_ascii_strcasecmp</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors_hash_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sensors_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-463"></a>            <span class="n">hle</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<a name="line-464"></a>            <span class="k">break</span><span class="p">;</span>
<a name="line-465"></a>        <span class="p">}</span>
<a name="line-466"></a>    <span class="p">}</span>
<a name="line-467"></a>
<a name="line-468"></a>    <span class="cm">/* lists are the same -&gt; nothing to do */</span>
<a name="line-469"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">hle</span><span class="p">)</span> <span class="p">{</span>
<a name="line-470"></a><span class="cp">#ifdef SORT_DEBUG</span>
<a name="line-471"></a>        <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERR</span><span class="p">,</span> <span class="s">&quot;sensor sort: saved list is the same as the new one, returning&quot;</span><span class="p">);</span>
<a name="line-472"></a><span class="cp">#endif</span>
<a name="line-473"></a>
<a name="line-474"></a>        <span class="cm">/* still need to free the array */</span>
<a name="line-475"></a>        <span class="n">g_strfreev</span> <span class="p">(</span><span class="n">sensors_list</span><span class="p">);</span>
<a name="line-476"></a>        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-477"></a>    <span class="p">}</span>
<a name="line-478"></a>
<a name="line-479"></a><span class="cp">#ifdef SORT_DEBUG</span>
<a name="line-480"></a>    <span class="n">sensors_applet_settings_print_sensors_tree</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">);</span>
<a name="line-481"></a><span class="cp">#endif</span>
<a name="line-482"></a>
<a name="line-483"></a>
<a name="line-484"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nb">NULL</span> <span class="o">!=</span> <span class="n">sensors_list</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a name="line-485"></a>
<a name="line-486"></a>        <span class="cm">/* first pass */</span>
<a name="line-487"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-488"></a>            <span class="cm">/* make a copy */</span>
<a name="line-489"></a>            <span class="n">hash_a</span> <span class="o">=</span> <span class="n">g_strdup</span> <span class="p">(</span><span class="n">sensors_list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a name="line-490"></a>            <span class="k">continue</span><span class="p">;</span>
<a name="line-491"></a>        <span class="p">}</span>
<a name="line-492"></a>
<a name="line-493"></a>        <span class="n">hash_b</span> <span class="o">=</span> <span class="n">g_strdup</span> <span class="p">(</span><span class="n">sensors_list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a name="line-494"></a>
<a name="line-495"></a>        <span class="cm">/* now that we have two hashes, find the two corresponding sensors and sort them</span>
<a name="line-496"></a><span class="cm">         * if i == 1, we have both a and b set, this is the first time calling this function */</span>
<a name="line-497"></a>        <span class="n">ret_val</span> <span class="o">=</span> <span class="n">sensors_applet_settings_sort_sensors_sort</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">,</span> <span class="n">hash_a</span><span class="p">,</span> <span class="n">hash_b</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">first_counter</span><span class="p">));</span>
<a name="line-498"></a>
<a name="line-499"></a>        <span class="cm">/* hash_b has already been removed from the system</span>
<a name="line-500"></a><span class="cm">         * don&#39;t free hash_a, don&#39;t reassign hash_b</span>
<a name="line-501"></a><span class="cm">         * as we already know that b is no longer in the system */</span>
<a name="line-502"></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">2</span> <span class="o">==</span> <span class="n">ret_val</span><span class="p">)</span> <span class="p">{</span>
<a name="line-503"></a>            <span class="k">continue</span><span class="p">;</span>
<a name="line-504"></a>        <span class="p">}</span>
<a name="line-505"></a>
<a name="line-506"></a>        <span class="cm">/* after sorting free hash_a (it should be in place) and reassign hash_b to hash_a */</span>
<a name="line-507"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">hash_a</span><span class="p">);</span>
<a name="line-508"></a>        <span class="n">hash_a</span> <span class="o">=</span> <span class="n">hash_b</span><span class="p">;</span>
<a name="line-509"></a>
<a name="line-510"></a>        <span class="cm">/* hash_a not found</span>
<a name="line-511"></a><span class="cm">         * set hash_b as hash_a and set the first element counter</span>
<a name="line-512"></a><span class="cm">         * (essentially skip the first element in the sensors-list array) */</span>
<a name="line-513"></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">3</span> <span class="o">==</span> <span class="n">ret_val</span><span class="p">)</span> <span class="p">{</span>
<a name="line-514"></a>            <span class="n">first_counter</span><span class="o">++</span><span class="p">;</span>
<a name="line-515"></a>        <span class="p">}</span>
<a name="line-516"></a>    <span class="p">}</span>
<a name="line-517"></a>
<a name="line-518"></a><span class="cp">#ifdef SORT_DEBUG</span>
<a name="line-519"></a>    <span class="n">sensors_applet_settings_print_sensors_tree</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">);</span>
<a name="line-520"></a><span class="cp">#endif</span>
<a name="line-521"></a>
<a name="line-522"></a>    <span class="cm">/* hash_a already freed</span>
<a name="line-523"></a><span class="cm">     * only in the following case do we need to free it */</span>
<a name="line-524"></a>    <span class="k">if</span> <span class="p">(</span><span class="mi">2</span> <span class="o">==</span> <span class="n">ret_val</span><span class="p">)</span> <span class="p">{</span>
<a name="line-525"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">hash_a</span><span class="p">);</span>
<a name="line-526"></a>    <span class="p">}</span>
<a name="line-527"></a>    <span class="n">g_free</span> <span class="p">(</span><span class="n">hash_b</span><span class="p">);</span>
<a name="line-528"></a>
<a name="line-529"></a>    <span class="n">g_strfreev</span> <span class="p">(</span><span class="n">sensors_list</span><span class="p">);</span>
<a name="line-530"></a>
<a name="line-531"></a>    <span class="cm">/* reorder active sensors based on reordered sensors tree */</span>
<a name="line-532"></a>    <span class="n">sensors_applet_reorder_sensors</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="p">);</span>
<a name="line-533"></a>
<a name="line-534"></a>    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-535"></a><span class="p">}</span>
<a name="line-536"></a>
<a name="line-537"></a><span class="cm">/* save sensor data under a unique hash</span>
<a name="line-538"></a><span class="cm"> * save sensor sort in an array, with above hash */</span>
<a name="line-539"></a><span class="n">gboolean</span> <span class="nf">sensors_applet_settings_save_sensors</span> <span class="p">(</span><span class="n">SensorsApplet</span> <span class="o">*</span><span class="n">sensors_applet</span><span class="p">)</span> <span class="p">{</span>
<a name="line-540"></a>
<a name="line-541"></a>    <span class="cm">/* write everything to GSettings except VISIBLE and ALARM_TIMEOUT_INDEX</span>
<a name="line-542"></a><span class="cm">     * for stepping through GtkTreeStore data structure */</span>
<a name="line-543"></a>    <span class="n">GtkTreeIter</span> <span class="n">interfaces_iter</span><span class="p">;</span>
<a name="line-544"></a>    <span class="n">GtkTreeIter</span> <span class="n">sensors_iter</span><span class="p">;</span>
<a name="line-545"></a>    <span class="n">gboolean</span> <span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-546"></a><span class="hll">    <span class="n">gboolean</span> <span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span><span class='error2'>&lt;--- Variable 'not_end_of_sensors' is assigned a value that is never used.</span>
</span><a name="line-547"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">applet_path</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-548"></a>
<a name="line-549"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_path</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-550"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_id</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-551"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_label</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-552"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_interface</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-553"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_low_alarm_command</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-554"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_high_alarm_command</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-555"></a>    <span class="n">gchar</span> <span class="o">*</span><span class="n">current_graph_color</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-556"></a>    <span class="n">gboolean</span> <span class="n">current_enable</span><span class="p">,</span>
<a name="line-557"></a>             <span class="n">current_alarm_enable</span><span class="p">;</span>
<a name="line-558"></a>    <span class="n">gdouble</span> <span class="n">current_low_value</span><span class="p">,</span>
<a name="line-559"></a>            <span class="n">current_high_value</span><span class="p">,</span>
<a name="line-560"></a>            <span class="n">current_multiplier</span><span class="p">,</span>
<a name="line-561"></a>            <span class="n">current_offset</span><span class="p">;</span>
<a name="line-562"></a>    <span class="n">guint</span> <span class="n">current_alarm_timeout</span><span class="p">,</span>
<a name="line-563"></a>          <span class="n">current_sensor_type</span><span class="p">,</span>
<a name="line-564"></a>          <span class="n">current_icon_type</span><span class="p">;</span>
<a name="line-565"></a>
<a name="line-566"></a>    <span class="cm">/* data structure (array) to be able to save sensors list to gsettings */</span>
<a name="line-567"></a>    <span class="n">GVariantBuilder</span> <span class="n">builder</span><span class="p">;</span>
<a name="line-568"></a>    <span class="n">g_variant_builder_init</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">builder</span><span class="p">,</span> <span class="n">G_VARIANT_TYPE</span> <span class="p">(</span><span class="n">GSGVTSA</span><span class="p">));</span>
<a name="line-569"></a>
<a name="line-570"></a>    <span class="n">applet_path</span> <span class="o">=</span> <span class="n">mate_panel_applet_get_preferences_path</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">applet</span><span class="p">);</span>
<a name="line-571"></a>
<a name="line-572"></a>    <span class="cm">/* now step through the GtkTreeStore sensors to find which sensors are available / loaded */</span>
<a name="line-573"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">gtk_tree_model_get_iter_first</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">);</span>
<a name="line-574"></a>        <span class="n">not_end_of_interfaces</span><span class="p">;</span>
<a name="line-575"></a>        <span class="n">not_end_of_interfaces</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">))</span> <span class="p">{</span>
<a name="line-576"></a>
<a name="line-577"></a>
<a name="line-578"></a>        <span class="k">for</span> <span class="p">(</span><span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_children</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">interfaces_iter</span><span class="p">);</span>
<a name="line-579"></a>            <span class="n">not_end_of_sensors</span><span class="p">;</span>
<a name="line-580"></a>            <span class="n">not_end_of_sensors</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">))</span> <span class="p">{</span>
<a name="line-581"></a>
<a name="line-582"></a>            <span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">sensors</span><span class="p">),</span>
<a name="line-583"></a>                               <span class="o">&amp;</span><span class="n">sensors_iter</span><span class="p">,</span>
<a name="line-584"></a>                               <span class="n">PATH_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_path</span><span class="p">,</span>
<a name="line-585"></a>                               <span class="n">ID_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_id</span><span class="p">,</span>
<a name="line-586"></a>                               <span class="n">LABEL_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_label</span><span class="p">,</span>
<a name="line-587"></a>                               <span class="n">INTERFACE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_interface</span><span class="p">,</span>
<a name="line-588"></a>                               <span class="n">SENSOR_TYPE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_sensor_type</span><span class="p">,</span>
<a name="line-589"></a>                               <span class="n">ENABLE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_enable</span><span class="p">,</span>
<a name="line-590"></a>                               <span class="n">LOW_VALUE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_low_value</span><span class="p">,</span>
<a name="line-591"></a>                               <span class="n">HIGH_VALUE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_high_value</span><span class="p">,</span>
<a name="line-592"></a>                               <span class="n">ALARM_ENABLE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_alarm_enable</span><span class="p">,</span>
<a name="line-593"></a>                               <span class="n">LOW_ALARM_COMMAND_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_low_alarm_command</span><span class="p">,</span>
<a name="line-594"></a>                               <span class="n">HIGH_ALARM_COMMAND_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_high_alarm_command</span><span class="p">,</span>
<a name="line-595"></a>                               <span class="n">ALARM_TIMEOUT_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_alarm_timeout</span><span class="p">,</span>
<a name="line-596"></a>                               <span class="n">MULTIPLIER_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_multiplier</span><span class="p">,</span>
<a name="line-597"></a>                               <span class="n">OFFSET_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_offset</span><span class="p">,</span>
<a name="line-598"></a>                               <span class="n">ICON_TYPE_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_icon_type</span><span class="p">,</span>
<a name="line-599"></a>                               <span class="n">GRAPH_COLOR_COLUMN</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">current_graph_color</span><span class="p">,</span>
<a name="line-600"></a>                               <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<a name="line-601"></a>
<a name="line-602"></a>            <span class="cm">/* GSettings unique id for one sensor data */</span>
<a name="line-603"></a>            <span class="n">gchar</span> <span class="o">*</span><span class="n">gsuid</span> <span class="o">=</span> <span class="n">sensors_applet_settings_get_unique_id</span> <span class="p">(</span><span class="n">current_interface</span><span class="p">,</span> <span class="n">current_id</span><span class="p">,</span> <span class="n">current_path</span><span class="p">);</span>
<a name="line-604"></a>
<a name="line-605"></a>            <span class="cm">/* save sensor uid to gvariant array */</span>
<a name="line-606"></a>            <span class="n">g_variant_builder_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">builder</span><span class="p">,</span>
<a name="line-607"></a>                <span class="n">GSGVTS</span><span class="p">,</span>       <span class="cm">/* must be related to the G_VARIANT_TYPE in init and gsettings schema */</span>
<a name="line-608"></a>                <span class="n">gsuid</span><span class="p">);</span>
<a name="line-609"></a>
<a name="line-610"></a>            <span class="cm">/* save sensor data to gsettings individually</span>
<a name="line-611"></a><span class="cm">             * g_strdup_printf doesn&#39;t free args!</span>
<a name="line-612"></a><span class="cm">             * applet_path is freed at the end */</span>
<a name="line-613"></a>            <span class="n">gchar</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="n">g_strdup_printf</span> <span class="p">(</span><span class="s">&quot;%s%s/&quot;</span><span class="p">,</span> <span class="n">applet_path</span><span class="p">,</span> <span class="n">gsuid</span><span class="p">);</span>
<a name="line-614"></a>            <span class="n">g_free</span> <span class="p">(</span><span class="n">gsuid</span><span class="p">);</span>
<a name="line-615"></a>
<a name="line-616"></a>            <span class="n">GSettings</span> <span class="o">*</span><span class="n">settings</span><span class="p">;</span>
<a name="line-617"></a>            <span class="n">settings</span> <span class="o">=</span> <span class="n">g_settings_new_with_path</span> <span class="p">(</span><span class="s">&quot;org.mate.sensors-applet.sensor&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
<a name="line-618"></a>            <span class="n">g_free</span> <span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a name="line-619"></a>
<a name="line-620"></a>            <span class="cm">/* wait until g_settings_apply() is called to save all changes at once to gsettings */</span>
<a name="line-621"></a>            <span class="n">g_settings_delay</span> <span class="p">(</span><span class="n">settings</span><span class="p">);</span>
<a name="line-622"></a>            <span class="n">g_settings_set_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">current_path</span><span class="p">);</span>
<a name="line-623"></a>            <span class="n">g_settings_set_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">current_id</span><span class="p">);</span>
<a name="line-624"></a>            <span class="n">g_settings_set_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">LABEL</span><span class="p">,</span> <span class="n">current_label</span><span class="p">);</span>
<a name="line-625"></a>            <span class="n">g_settings_set_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">INTERFACE</span><span class="p">,</span> <span class="n">current_interface</span><span class="p">);</span>
<a name="line-626"></a>            <span class="n">g_settings_set_int</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">SENSOR_TYPE</span><span class="p">,</span> <span class="n">current_sensor_type</span><span class="p">);</span>
<a name="line-627"></a>            <span class="n">g_settings_set_boolean</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ENABLED</span><span class="p">,</span> <span class="n">current_enable</span><span class="p">);</span>
<a name="line-628"></a>            <span class="n">g_settings_set_double</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">LOW_VALUE</span><span class="p">,</span> <span class="n">current_low_value</span><span class="p">);</span>
<a name="line-629"></a>            <span class="n">g_settings_set_double</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">HIGH_VALUE</span><span class="p">,</span> <span class="n">current_high_value</span><span class="p">);</span>
<a name="line-630"></a>            <span class="n">g_settings_set_boolean</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ALARM_ENABLED</span><span class="p">,</span> <span class="n">current_alarm_enable</span><span class="p">);</span>
<a name="line-631"></a>            <span class="n">g_settings_set_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">LOW_ALARM_COMMAND</span><span class="p">,</span> <span class="n">current_low_alarm_command</span><span class="p">);</span>
<a name="line-632"></a>            <span class="n">g_settings_set_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">HIGH_ALARM_COMMAND</span><span class="p">,</span> <span class="n">current_high_alarm_command</span><span class="p">);</span>
<a name="line-633"></a>            <span class="n">g_settings_set_int</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ALARM_TIMEOUT</span><span class="p">,</span> <span class="n">current_alarm_timeout</span><span class="p">);</span>
<a name="line-634"></a>            <span class="n">g_settings_set_double</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">MULTIPLIER</span><span class="p">,</span> <span class="n">current_multiplier</span><span class="p">);</span>
<a name="line-635"></a>            <span class="n">g_settings_set_double</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">OFFSET</span><span class="p">,</span> <span class="n">current_offset</span><span class="p">);</span>
<a name="line-636"></a>            <span class="n">g_settings_set_int</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">ICON_TYPE</span><span class="p">,</span> <span class="n">current_icon_type</span><span class="p">);</span>
<a name="line-637"></a>            <span class="n">g_settings_set_string</span> <span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">GRAPH_COLOR</span><span class="p">,</span> <span class="n">current_graph_color</span><span class="p">);</span>
<a name="line-638"></a>            <span class="n">g_settings_apply</span> <span class="p">(</span><span class="n">settings</span><span class="p">);</span>
<a name="line-639"></a>            <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">settings</span><span class="p">);</span>
<a name="line-640"></a>
<a name="line-641"></a>        <span class="p">}</span>
<a name="line-642"></a>    <span class="p">}</span>
<a name="line-643"></a>
<a name="line-644"></a>    <span class="cm">/* save the sensor-list array to gsettings</span>
<a name="line-645"></a><span class="cm">     * builder is freed by g_variant_builder_end()</span>
<a name="line-646"></a><span class="cm">     * the gvariant returned from g_variant_builder_end() is floating, so it is freed by g_settings_set_value() */</span>
<a name="line-647"></a>    <span class="n">g_settings_set_value</span> <span class="p">(</span><span class="n">sensors_applet</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span> <span class="s">&quot;sensors-list&quot;</span><span class="p">,</span> <span class="n">g_variant_builder_end</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">builder</span><span class="p">));</span>
<a name="line-648"></a>
<a name="line-649"></a>    <span class="n">g_free</span> <span class="p">(</span><span class="n">applet_path</span><span class="p">);</span>
<a name="line-650"></a>
<a name="line-651"></a>    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-652"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div>
      <div id="footer">
        <p>
         Cppcheck 1.87 - a tool for static C/C++ code analysis</br>
         </br>
         Internet: <a href="http://cppcheck.net">http://cppcheck.net</a></br>
         IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a></br>
        <p>
      </div>
  </body>
</html>
